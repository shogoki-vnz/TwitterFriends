/*! TwitterFrieds v0.1 | Autor: Jhean Ceballos: @shogoki_vnz is released under the MIT License <http://www.opensource.org/licenses/mit-license.php*/
var TwitterFriends=function(){var a=[];var b;var c=false;var d=false;var e;var f=100;var g=function(a){if(!c){var b=$.isNumeric(a)?"user_id="+a:"screen_name="+a;var d="//api.twitter.com/1/friends/ids.json?cursor=-1&"+b;$.ajax({type:"GET",url:d,dataType:"jsonp",timeout:8e3,error:function(a,b){j();console.log("An error occurred when completing the request, please check that the username or id are valid")},success:function(a,b){var c=a.ids;var d=c.length;h(c)}})}};var h=function(b){var d=b.length;var e=d>f?b.splice(0,f):b.join();var g="//api.twitter.com/1/users/lookup.json?user_id="+e;$.ajax({type:"GET",url:g,dataType:"jsonp",success:function(e,g){var i=e.length;for(var j=0;j<i;j++){a.push({name:e[j].screen_name,avatar:e[j].profile_image_url})}if(d>f){h(b)}else{k();c=true}}})};var i=function(){var a=b.width();var c=b.position();var d=c.top;var e=c.left+a-16;var f=$('<div id="twittUserPloader"></div>').css("top",d).css("left",e);b.parent().append(f)};var j=function(){$("#twittUserPloader").fadeOut("slow")};var k=function(){var c=$('<div id="twitterUsers"></div>');var f=a.length;for(var g=0;g<f;g++){var h=a[g].name;var i=a[g].avatar;$div=$('<div class="info" data-username="@'+h+'"></div>').css("display","none").on("click",function(){l($(this).attr("data-username"))});$div.append($('<img src="'+i+'" width="24px" height="24px"/>'));$div.append($("<p>@"+h+"</p>"));c.append($div)}b.parent().append(c);b.on("keydown",function(a){if(d){if(a.keyCode==13){a.preventDefault();l($(".selected").attr("data-username"))}else if(a.keyCode==9){a.preventDefault();l($(".selected").attr("data-username"))}else if(a.keyCode==38||a.keyCode==37){a.preventDefault();var b=$("#twitterUsers").find(".selected").removeClass("selected").prevAll().filter(":visible").first();if(b.length==1)b.addClass("selected");else $(".info").filter(":visible").last().addClass("selected")}else if(a.keyCode==40||a.keyCode==39){a.preventDefault();var b=$("#twitterUsers").find(".selected").removeClass("selected").nextAll().filter(":visible").first();if(b.length==1)b.addClass("selected");else $(".info").filter(":visible").first().addClass("selected")}}});b.on("keyup",function(a){if(!d){var b=/@(?![a-z\-.0-9])/i;e="@";var c=$(this).val();var f=c.match(b);if(f){m();o()}}else{var g=/[a-z\-.]/i;if(g.test(String.fromCharCode(a.keyCode))){var h=String.fromCharCode(a.keyCode);e=e.concat(h);o()}else if(a.keyCode==32){n()}else if(a.keyCode==8){if(e.length==1){n()}else{e=e.substr(0,e.length-1);o()}}}});j()};var l=function(a){if(a!=undefined){var c=e.length>1?new RegExp(e,"i"):/@(?![a-z\-.0-9])/i;var d=b.val().replace(c,a);b.val(d)}b.get(0).focus();p(d.length);n()};var m=function(){if(!d){var a=b.width()>200?b.width():200;var c=b.height();var e=150;var f=b.position();var g=f.top>e?f.top-e:f.top+c;var h=f.left;$("#twitterUsers").css("width",a).css("height",e).css("top",g).css("left",h);$("#twitterUsers").fadeIn(500);d=true}};var n=function(){if(d){$("#twitterUsers").fadeOut(300);d=false;$(".info").css("display","none");e=""}};var o=function(){$(".info").css("display","none").removeClass("selected").filter(function(a){var b=new RegExp(e,"i");return b.test($(this).attr("data-username"))}).css("display","block");$(".info").filter(":visible").first().addClass("selected")};var p=function(a){if(b.get(0).setSelectionRange){b.get(0).setSelectionRange(a,a)}else if(b.get(0).createTextRange){var c=b.get(0).createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",a);c.select()}};return{Init:function(a,c){b=c;if(b.is(":visible")){i()}g(a)}}}()